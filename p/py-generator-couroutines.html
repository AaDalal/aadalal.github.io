<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.B2qIdcSH.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CMA4iOj_.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/COF6m0iz.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/WjKqBSco.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BTykkvGJ.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.CS3c45Wd.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/z7WzBOfM.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CY9FYKcK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BOKyN92P.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.xI6WVgmj.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/oPucQqzi.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.DL91LGBd.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BFHx90Sw.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Be_KLNhx.js"><!--xod7dh--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous"/><!----><title>Python Coroutines!?!? | aagam's blog</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><!--[--><!----><main><div><article class="max-w-2xl mx-auto px-3 mt-4"><header><div class="min-h-20 py-2 flex items-end"><a href="/">‚Üê Back</a></div> <div class="dark:bg-orange-800 bg-orange-900/60"><div class="italic opacity-75 mb-2 ml-2 bg-transparent"><time>2023-06-11</time></div> <h1 class="text-8xl leading-none w-3/4 font-junicode mb-10 ml-1 bg-none">Python Coroutines!?!?</h1></div></header> <section class="prose dark:prose-invert prose-a:text-blue-600 dark:prose-a:text-blue-500 hover:prose-a:text-blue-900 hover:dark:prose-a:text-blue-800 dark:prose-pre:border-gray-900 dark:prose-pre:border leading-1 first-letter:text-5xl first-letter:mr-2 first-letter:leading-none first-letter:float-left first-letter:border-solid first-letter:px-1"><!----><p>Python supports generators which allow you to <code>.send()</code> and recieve (via <code>next(...)</code>) values. They are kind of like channels since they don't block until you send or recieve.</p>
<p>In the code below, we use callbacks (called aperiodically in a separate thread) to send values to our channel. Simultaneously, we try to consume those values, which should be allowed because generators and our <code>coroutine</code> are non-blocking.</p>
<pre><code class="language-python">import time, threading

def channel(x="Hello"):
    while True:
        x = yield x

def make_coroutine(callback):
    def coroutine():
        callback()
        threading.Timer(1, coroutine).start()
    return coroutine

def make_callback():
    chan = channel()
    # prime the channel
    next(chan)

    def callback():
        print("Calling!")
        chan.send("Hello world!")
    
    return chan, callback

def main():
    chan, callback = make_callback()
    coroutine = make_coroutine(callback)
    coroutine()
    for i in chan:
        if i is not None:
            print(i)

if __name__ == "__main__":
    main()
</code></pre>
<p>And yet, this approach doesn't work as expected! One of three things happens:</p>
<ol>
<li><code>ValueError: generator already executing</code></li>
<li>only None values are output from the channel</li>
</ol>
<p>Why doesn't this work? email me if you have an answer.</p><!----></section> <!--[!--><!--]--> <!--[!--><!--]--></article></div><!----></main><!----><!--]--><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_44x7kk = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.CMA4iOj_.js"),
						import("../_app/immutable/entry/app.CS3c45Wd.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data: [null,{type:"data",data:{post:{title:"Python Coroutines!?!?",date:"2023-06-11",slug:"py-generator-couroutines",content:"\u003Cp>Python supports generators which allow you to \u003Ccode>.send()\u003C/code> and recieve (via \u003Ccode>next(...)\u003C/code>) values. They are kind of like channels since they don't block until you send or recieve.\u003C/p>\n\u003Cp>In the code below, we use callbacks (called aperiodically in a separate thread) to send values to our channel. Simultaneously, we try to consume those values, which should be allowed because generators and our \u003Ccode>coroutine\u003C/code> are non-blocking.\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-python\">import time, threading\n\ndef channel(x=\"Hello\"):\n    while True:\n        x = yield x\n\ndef make_coroutine(callback):\n    def coroutine():\n        callback()\n        threading.Timer(1, coroutine).start()\n    return coroutine\n\ndef make_callback():\n    chan = channel()\n    # prime the channel\n    next(chan)\n\n    def callback():\n        print(\"Calling!\")\n        chan.send(\"Hello world!\")\n    \n    return chan, callback\n\ndef main():\n    chan, callback = make_callback()\n    coroutine = make_coroutine(callback)\n    coroutine()\n    for i in chan:\n        if i is not None:\n            print(i)\n\nif __name__ == \"__main__\":\n    main()\n\u003C/code>\u003C/pre>\n\u003Cp>And yet, this approach doesn't work as expected! One of three things happens:\u003C/p>\n\u003Col>\n\u003Cli>\u003Ccode>ValueError: generator already executing\u003C/code>\u003C/li>\n\u003Cli>only None values are output from the channel\u003C/li>\n\u003C/ol>\n\u003Cp>Why doesn't this work? email me if you have an answer.\u003C/p>",tags:"async,asyncio,python,coroutine,generator"},allPosts:[{title:"Go fast!",slug:"fast",date:"2024-01-01"},{title:"Consistent Hashing",slug:"consistent-hashing",date:"2023-10-26"},{title:"Rendevous Hashing",slug:"rendevous-hashing",date:"2023-10-26"},{title:"Python Coroutines!?!?",slug:"py-generator-couroutines",date:"2023-06-11"},{title:"Lessons from Product Managing",slug:"PMing",date:"2023-06-01"},{title:"Einsum",slug:"einsum",date:"2022-03-14"},{title:"Entropy",slug:"entropy",date:"2021-12-28"},{title:"Try again with sudo: _sudo",slug:"_sudo",date:"2021-11-11"},{title:"Roku & Competition",slug:"competition-focus",date:"2021-11-11"}]},uses:{params:["slug"]}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
